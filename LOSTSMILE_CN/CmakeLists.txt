cmake_minimum_required(VERSION 3.20.0)
project(LOSTSMILE_CN VERSION 1.0)

set(CMAKE_CXX_STANDARD 23)
set(SOURCE_DIR "${CMAKE_CURRENT_LIST_DIR}/src")
add_definitions("-DPROJECT_NAME=\"${PROJECT_NAME}\"")
add_definitions("-DPROJECT_VERSION=\"${PROJECT_VERSION}\"")

# 安装 VC-LTL5（可选）
# https://github.com/Chuyu-Team/VC-LTL5/releases/latest
include("VC-LTL helper for cmake.cmake")

if (MSVC)
	set(CMAKE_CXX_FLAGS_RELEASE "/O1 /Ob2 /DNDEBUG")
    add_compile_options(
        "/source-charset:utf-8"
        "$<$<CONFIG:Release>:/GF>"
        "$<$<CONFIG:Release>:/Oy>"
        "$<$<CONFIG:Release>:/GL>"
        "$<$<CONFIG:Release>:/GS->"
    )
    if(${CMAKE_BUILD_TYPE} STREQUAL "Release")
        set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded")
    elseif(${CMAKE_BUILD_TYPE} STREQUAL "Debug")
        set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreadedDebug")
        set(DEBUG_ONLY_CONSOLE_CPP "${SOURCE_DIR}/lib/console.cpp")
    endif()
endif(MSVC)


add_executable(LAUNCHER 
	"${SOURCE_DIR}/launcher.cpp" 
)
set_target_properties(LAUNCHER 
	PROPERTIES OUTPUT_NAME ${PROJECT_NAME}
)
target_include_directories(LAUNCHER 
	PUBLIC "${SOURCE_DIR}/lib"
)
target_link_libraries(LAUNCHER 
	"${SOURCE_DIR}/lib/detours.lib"
	"${SOURCE_DIR}/launcher.icon.res"
)
set_target_properties(LAUNCHER 
	PROPERTIES OUTPUT_NAME ${PROJECT_NAME}
	LINK_FLAGS "/DYNAMICBASE:NO /MANIFEST:NO"
)

add_library(DLLMAIN SHARED 
	"${SOURCE_DIR}/dllmain.cpp"
	"${DEBUG_ONLY_CONSOLE_CPP}"
)

set_target_properties(DLLMAIN 
	PROPERTIES OUTPUT_NAME ${PROJECT_NAME}
	LINK_FLAGS "/DYNAMICBASE:NO /MANIFEST:NO"
)

target_include_directories(DLLMAIN 
	PUBLIC "${SOURCE_DIR}/lib"
)
target_link_libraries(DLLMAIN 
	"${SOURCE_DIR}/lib/detours.lib"
)